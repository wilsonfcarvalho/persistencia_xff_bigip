# persistencia_xff_bigip
Este documento tem como objetivo registrar uma solução utilizada para atender a uma demanda de configuração de persistência nos Bigips, inicialmente a persistência por endereço IP de origem (source-address) atenderia a necessidade, porém a estrutura onde o Bigip está localizado fica "atrás" de um proxy, portanto o ip de origem sempre seria o IP do proxy em vez do IP real do cliente. Foi então configurada uma irule para fazer a persistência com base no valor do cabaçalho XFF (X-Forwarded-For).  Existe uma verificação adicional que verifica se o campo "True-Client_IP" existe no cabeçalho da requisição, esse tipo de cabeçalho normalmente é utilizado quando a requisição passa por um akamai antes de chegar a estrutura do cliente, isso porque o akamai preenche o valor do XFF com o seu próprio IP, e o IP real do cliente é então armazenado no campo True-Client-IP.
